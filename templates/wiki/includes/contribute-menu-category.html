{% load i18n sekizai_tags static %}

<div>
  <div class="illustration-container"><div class="contribute-small"></div></div>
  <div class="contribution-area">
        <a href="{% url 'wiki:create' path=urlpath.path %}">
          <span class="underlined green hover">{% blocktrans with article.current_revision.title as title %}Neues Problemfeld in dieser Kategorie erstellen</span> <i class="bi bi-arrow-right"></i>{% endblocktrans %}
        </a>
  </div>
</div>

<div class="clearfix"></div>

<br>
<div id="app">
  <v-app id="inspire">
    <v-toolbar
    >
      <v-autocomplete
        v-model="select"
        :loading="loading"
        :items="items"
        :search-input.sync="search"
		item-text="title"
		item-value="title"
        flat
        hide-no-data
        hide-details
        label="Problemfeldsuche"
      >
        <template v-slot:item="data">
          <template v-if="typeof data.item !== 'object'">
            <v-list-item-content v-text="data.item"></v-list-item-content>
          </template>
          <template v-else>
            <v-list-item-content @click="redirect(data.item.url)" @keydown.down="redirect(data.item.url)">
              <v-list-item-title v-html="data.item.title"></v-list-item-title>
              <v-list-item-subtitle v-html="data.item.breadcrumb"></v-list-item-subtitle>
            </v-list-item-content>
          </template>
        </template>
      </v-autocomplete>
    </v-toolbar>
  </v-app>
</div>

<script>
	new Vue({
  	  el: '#app',
  	  vuetify: new Vuetify(),
  	  data () {
    	return {
      	  loading: false,
      	  items: [],
      	  search: null,
      	  select: null,
    	}
  	  },
  	  watch: {
    	search (val) {
      	  val && val !== this.select && this.querySelections(val)
    	},
  	  },
  	  methods: {
  		redirect(url) {
  			window.location.href = url
  		},
    	querySelections (query) {
  		this.loading = true

		fetch(`/run/search/wiki/${query}`)
      	  .then(res => res.json())
      	  .then(res => {
        	this.items = res.data
      	  })
      	  .catch(err => {
        	console.log(err)
      	  })
      	  .finally(() => (this.loading = false))
    	},
  	  },
	})
</script>
